<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Carrinho 3D</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; }
    #addBtn {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 10px 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>

<button id="addBtn" onclick="addItem()">Adicionar item</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/FontLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/geometries/TextGeometry.js"></script>

<script>
// ------------------------------------------------------
//  CONFIGURAÇÃO BÁSICA
// ------------------------------------------------------
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Luz
const light = new THREE.PointLight(0xffffff, 2);
light.position.set(5, 5, 5);
scene.add(light);

// ------------------------------------------------------
//  MODELO 3D DO CARRINHO (simples com cubos)
// ------------------------------------------------------
const cart = new THREE.Group();

// Base
const baseGeo = new THREE.BoxGeometry(2, 0.5, 1);
const mat = new THREE.MeshStandardMaterial({ color: 0x00aaff });
const base = new THREE.Mesh(baseGeo, mat);
cart.add(base);

// Corpo
const bodyGeo = new THREE.BoxGeometry(2, 1, 1);
const body = new THREE.Mesh(bodyGeo, mat);
body.position.y = 0.8;
cart.add(body);

cart.position.z = -5;
scene.add(cart);

// ------------------------------------------------------
//  BOLINHA DO CONTADOR 3D
// ------------------------------------------------------
const contadorGroup = new THREE.Group();

const sphereGeo = new THREE. SphereGeometry(0.35, 32, 32);
const sphereMat = new THREE.MeshStandardMaterial({ color: 0xff2222 });
const sphere = new THREE.Mesh(sphereGeo, sphereMat);
sphere.position.set(1.3, 1.5, 0);
contadorGroup.add(sphere);

// texto 3D
let contadorTexto;
let quantidade = 0;

const loader = new THREE.FontLoader();
loader.load("https://threejs.org/examples/fonts/helvetiker_bold.typeface.json", function(font) {
    atualizarTexto(font);
});

// função para atualizar o texto 3D
function atualizarTexto(font) {
    if (contadorTexto) contadorGroup.remove(contadorTexto);

    const textGeo = new THREE.TextGeometry(String(quantidade), {
        font: font,
        size: 0.35,
        height: 0.1
    });

    const textMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
    contadorTexto = new THREE.Mesh(textGeo, textMat);
    contadorTexto.position.set(1.1, 1.4, 0.4);
    contadorGroup.add(contadorTexto);
}

scene.add(contadorGroup);

// animação "POP" quando adiciona item
function animarPop() {
    let scale = 1;
    let growing = true;

    function pop() {
        if (growing) {
            scale += 0.05;
            if (scale >= 1.3) growing = false;
        } else {
            scale -= 0.05;
            if (scale <= 1) return; // fim
        }

        contadorGroup.scale.set(scale, scale, scale);
        requestAnimationFrame(pop);
    }
    pop();
}

// ------------------------------------------------------
//  FUNÇÃO PARA ADICIONAR ITEM
// ------------------------------------------------------
function addItem() {
    quantidade++;
    loader.load("https://threejs.org/examples/fonts/helvetiker_bold.typeface.json", atualizarTexto);
    animarPop();
}

// ------------------------------------------------------
//  ANIMAÇÃO PRINCIPAL
// ------------------------------------------------------
function animate() {
    requestAnimationFrame(animate);

    // carrinho girando levemente
    cart.rotation.y += 0.005;

    renderer.render(scene, camera);
}

animate();

// Ajuste ao redimensionar
window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
